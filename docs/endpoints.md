# API Endpoints Reference

This document provides a detailed reference for the HTTP API endpoints exposed by AUTORAY.

## Base URL

By default, the server listens on port `2873`.
`http://<server-ip>:2873`

---

## User Routes

These routes are public but require a valid User Key generated by an administrator.

### 1. Connect (Get Subscription)
Fetches the aggregated list of proxy configurations.

- **Endpoint**: `/connect`
- **Method**: `GET`
- **Parameters**:
  - `key` (Required): The user authentication key.
- **Response**: Plain text body containing `vless://`, `vmess://`, etc. links.
- **Example**:
  ```
  GET /connect?key=abc123xyz
  ```

### 2. Custom Subscription
Fetches the subscription with a custom name tag appended to each config. Useful for identifying specific devices or partners.

- **Endpoint**: `/custom`
- **Method**: `GET`
- **Parameters**:
  - `key` (Required): The user authentication key.
  - `name` (Required): The custom string to append (e.g., "MyPhone").
- **Response**: Plain text body with renamed configs.
- **Example**:
  ```
  GET /custom?key=abc123xyz&name=iPhone13
  ```

### 3. Ping
Health check endpoint to verify if the server is running.

- **Endpoint**: `/ping`
- **Method**: `GET`
- **Response**: `ALIVE`

---

## Admin Routes

All admin routes require the `api_secret` defined in `config.json`.

### Key Management

#### Create Key
Generates a new random 16-character user key.
- **Endpoint**: `/createkey`
- **Parameters**: `secret`
- **Response**: Success message with the new key and a pre-built subscription link.

#### Add Key
Manually adds a specific key to the allowed list.
- **Endpoint**: `/addkey`
- **Parameters**:
  - `secret`
  - `targetkey`: The specific key string to add.
- **Response**: `SUCCESS` or error message.

#### Delete Key
Removes a key, revoking access.
- **Endpoint**: `/delkey`
- **Parameters**:
  - `secret`
  - `targetkey`: The key to remove.
- **Response**: `SUCCESS` or `Nothing removed`.

#### List All Keys
Displays all active user keys.
- **Endpoint**: `/allkeys`
- **Parameters**: `secret`
- **Response**: Newline-separated list of keys.

### Channel Management

#### Add Channel
Adds a Telegram channel to the scraping list.
- **Endpoint**: `/addchannel`
- **Parameters**:
  - `secret`
  - `name`: Channel username (without @).
  - `mode`: Scraping mode (`count` or `time`). Default: `count`.
  - `limit`: Number of messages to scan (for `count` mode). Default: 25.
  - `days`: Number of days to look back (for `time` mode).
  - `hours`: Number of hours to look back (for `time` mode).
- **Example**:
  ```
  GET /addchannel?secret=MYSECRET&name=v2ray_channel&mode=time&days=1
  ```

#### Remove Channel
Removes a channel from the configuration.
- **Endpoint**: `/delchannel`
- **Parameters**:
  - `secret`
  - `name`: Channel username.

#### List Channels
Returns the current channel configuration JSON.
- **Endpoint**: `/listchannels`
- **Parameters**: `secret`

### System Management

#### Force Refresh
Triggers an immediate background scrape of all channels and updates the cache.
- **Endpoint**: `/freshconnect`
- **Parameters**: `secret`
- **Response**: Returns the freshly scraped subscription body.

#### Set Webhook
Configures the Discord Webhook URL for notifications.
- **Endpoint**: `/setwebhook`
- **Parameters**:
  - `secret`
  - `url`: The Discord Webhook URL.

---

## Error Codes

Most endpoints return plain text errors:
- `Access denied`: Incorrect `secret`.
- `Missing ...`: Required parameter not found.
- `vless://...@incorrectpasskey...`: Returned by subscription routes for invalid user keys.